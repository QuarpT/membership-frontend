@import com.gu.memsub.subsv2.SubscriptionPlan
@import com.gu.memsub.subsv2.Subscription
@import views.support.Dates._
@import views.support.Pricing._
@import com.gu.memsub.PaperDay
@import scala.collection.immutable.List.empty
@import com.gu.salesforce.Contact
@import org.joda.time.LocalDate
@import model.SubscriptionOps._


@import org.joda.time.LocalDate.now

@(chosenPaperDays: List[PaperDay] = empty, maybeContact: Option[Contact] = None, subscription: Subscription[SubscriptionPlan.PaperPlan])(extra: Html = Html(""))
<dl class="mma-section__list">
    <dt class="mma-section__list--title">Subscriber ID</dt>
    <dd class="mma-section__list--content">@{subscription.name.get}</dd>

    @planListLabel(singular: String, amount: Int) = {
    @if(amount > 1) {
        <dt class="mma-section__list--title">@{
            singular + "s"
        }</dt>
    }
    @if(amount == 1) {
        <dt class="mma-section__list--title">@singular</dt>
    }
    }

    @renderPlans(plans: List[SubscriptionPlan.PaperPlan], singularLabel: String) = {
     @planListLabel(singularLabel, plans.length)
        <dd class="mma-section__list--content">
        @for(plan <- plans) {
            <div>
            @if(plan.name == "Echo-Legacy") {
                Multi-day (@{
                chosenPaperDays.map(_.id.replace("Print ", "")).mkString(", ")
            })
            } else {
                @plan.name
            }
            </div>
            <div>@plan.charges.prettyPricing(plan.charges.price.currencies.head)</div>

            <div>@if(plan.start.isAfter(now)) { Starts: } else { Started: } @prettyDate(plan.start)</div>
        }
        </dd>

    }

    @renderPlans(subscription.currentPlans, "Current Plan")
    @renderPlans(subscription.futurePlans, "Upcoming Plan")

    @maybeContact.map { contact =>
        <dt class="mma-section__list--title">Delivery details</dt>
        <dd class="mma-section__list--content">
            <div>@contact.firstName @contact.lastName</div>
            <div>@{
                List(
                    contact.mailingStreet,
                    contact.mailingCity,
                    contact.mailingState,
                    contact.mailingPostcode,
                    contact.mailingCountry
                ).flatten.mkString(", ")}</div>
        </dd>
    }
    @extra
</dl>
